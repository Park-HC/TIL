# 시그널링

## 개요

- 통화를 가능하게 하는 초기 부트스트래핑
- WebRTC 에이전트들을 서로 직접 통신할 수 있게 지원
- 시그널링 메세지
  - 일반 텍스트 파일
  - Websockets 등으로 공유됨



## 작동 방식

- SDP 프로토콜을 통해 두 WebRTC 에이전트 사이 연결 설정에 필요한 모든 상태를 공유함
- 프로토콜 자체는 쉽지만 메시지 내용은 다소 복잡함



## SDP

```ini
a=my-sdp-value
a=second-value
```

- Session Description Protocol
- 키-값 쌍과 개행으로 이루어진 프로토콜
- 0개 이상의 미디어 Description이 포함됨

### 주요 키

| 키   | 설명                                                         |
| ---- | ------------------------------------------------------------ |
| v    | 버젼 정보<br />0이어야 함                                    |
| o    | Origin<br />재검토를 위한 고유 ID를 포함                     |
| s    | 세션 이름<br />`-`와 같아야 함                               |
| t    | 타이밍<br />`0 0`와 같아야 함                                |
| m    | 미디어 디스크립션                                            |
| a    | 속성<br />자유 형식의 텍스트 필드<br />WebRTC에서 가장 일반적인 파트 |
| c    | 연결 데이터<br />`IN IP4 0.0.0.0`과 같아야 함                |



### 세션 디스크립션(SD) 속 미디어 디스크립션

```ini
v=0
o=- 0 0 IN IP4 127.0.0.1
s=-
c=IN IP4 127.0.0.1
t=0 0
m=audio 4000 RTP/AVP 111	// 오디오 유형 111
a=rtpmap:111 OPUS/48000/2	// 비디오 유형 96
m=video 4000 RTP/AVP 96
a=rtpmap:96 VP8/90000
a=my-sdp-value
```

- 세션 디스크립션은 분량의 제한 없이 미디어 디스크립션을 서술할 수 있음
- format 목록이 포함 됨
  - 이 format은 RTP 페이로드 타입에 매핑됨
  - 실제 코덱은 미디어 디스크립션의 `rtpmap` 값에 있는 속성으로 정의됨



## WebRTC에서 SDP

### Offers/Answer Model

- 한 WebRTC 에이전트가 통화 시작하기 위해 '제안'
  - 다른 WebRTC 에이전트는 수락하고 싶으면 이에 대해 '응답'
- 이를 통해 응답자는 지원되지 않는 코덱을 거부할 수 있음



### Transceiver

- Js API에 미디어 디스크립션에 노출하는 것
- 각 미디어 디스크립션이 트랜시버가 됨
- 트랜시버가 생성될 때마다 새로운 미디어 디스크립션이 로컬 세션 설명에 추가 됨
- `send` `recv` `sendrecv` `inactive` 등 방향 속성에 유효한 값이 있음



### SDP 값

```
grou:BUNDLE
```

- 번들링은 하나의 연결을 통해 여러 유형의 트래픽을 실행하는 행위

```
fingerprint:sha-256
```

- 피어가 DTLS에 사용하는 인증서의 해시
- DTLS 핸드세이크가 완료된 후 이를 실제 인증서와 비교해 통신하고자 한 사람과 현재 통신 중인지 확인함

```
setup:
```

- DTLS 에이전트 동작을 제어
- ICE 연결 후 클라이언트로 실행되는 지 서버로 실행되는지 결정

```
setup:active
// DTLS 클라이언트로 실행

setup:passive
// DTLS 서버로 실행

setup:actpass
// 다른 WebRTC 에이전트에게 선택하도록 요청
```



```
mid
```

- "mid" 속성은 세션 설명 내에서 미디어 스트림을 식별하는 데 사용



```
ice-ufrag
```

- ICE 에이전트에 대한 조각값
- ICE 트래픽 인증에 이용



```
rtpmap
```

- 특정 코덱을 RTP 페이로드 유형에 매핑
- 모든 호출에 대해 제안자는 각 코덱의 페이로드 유형을 결정함



```
fmtp
```

- 하나의 페이로드 유형에 대한 추가 값 정의
- 특정 비디오 프로필 또는 인코더 설정 전달에 유용



```
candidate
```

- ICE 에이전트에서 온 ICE Candidate
- WebRTC 에이전트를 사용할 수 있는 주소 중 하나



```
ssrc
```

- Synchorization Source
- 단일 미디어 스트림 트랙을 정의함

